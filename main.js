(()=>{"use strict";function e(e){e.target===e.currentTarget&&o(e.target)}function t(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function n(n){n.classList.add("popup_opened"),n.addEventListener("click",e),document.addEventListener("keydown",t)}function o(n){n.classList.remove("popup_opened"),n.removeEventListener("click",e),document.removeEventListener("keydown",t)}function r(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}function a(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var c=document.querySelector(".content"),i=document.querySelector(".spinner"),u=c.querySelector(".profile__edit"),s=c.querySelector(".profile__avatar-edit"),l=document.querySelector(".popup_type_profile"),d=document.querySelector(".popup_type_avatar"),p=document.forms.profile,f=document.forms.avatar,m=p.elements.buttonSubmitProfile,_=f.querySelector(".popup__button"),v=c.querySelector(".profile__name"),y=c.querySelector(".profile__bio"),h=document.querySelectorAll(".popup__close"),S=c.querySelector(".profile__avatar"),b=document.querySelector(".popup_type_error"),q=b.querySelector(".popup__title");function L(e){e?(i.classList.add("spinner_visible"),c.classList.add("content_hidden")):(i.classList.remove("spinner_visible"),c.classList.remove("content_hidden"))}function k(e){n(b),q.textContent=e}h.forEach((function(e){e.addEventListener("click",(function(){o(document.querySelector(".popup_opened"))}))})),u.addEventListener("click",(function(){n(l)})),s.addEventListener("click",(function(){n(d)}));var E=document.querySelector(".popup_type_place"),C=document.querySelector(".popup_type_delete"),g=C.querySelector("#questionDelete"),x=document.forms.formPlace,T=x.querySelector(".popup__button"),I=document.querySelector(".elements"),z=document.querySelector(".popup_type_photo"),D=z.querySelector(".popup__photo"),P=z.querySelector(".popup__subtitle"),A=document.querySelector(".profile__add"),w=document.querySelector("#card-template").content,N=0;function O(e,t,o,r,a){I.prepend(function(e,t,o,r,a){var c=w.querySelector(".elements__card").cloneNode(!0),i=c.querySelector(".elements__count-like"),u=c.querySelector(".elements__like"),s=c.querySelector(".elements__photo"),l=c.querySelector(".elements__delete");return c.querySelector(".elements__title").textContent=e,s.alt=e,s.src=t,i.textContent=o.length,c.dataset.cardOwnerId=r,c.dataset.cardId=a,c.dataset.cardOwnerId!==v.dataset.myId?l.style.display="none":(l.style.display="block",l.addEventListener("click",(function(){n(C),N=c.dataset.cardId}))),o.some((function(e){return e._id===v.dataset.myId}))&&u.classList.add("elements__like_act"),u.addEventListener("click",(function(){var e;u.classList.contains("elements__like_act")?(u.classList.remove("elements__like_act"),e=c.dataset.cardId,fetch("https://nomoreparties.co/v1/plus-cohort-10/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36"}}),i.textContent=Number(i.textContent)-1):(u.classList.add("elements__like_act"),function(e){fetch("https://nomoreparties.co/v1/plus-cohort-10/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36"}})}(c.dataset.cardId),i.textContent=Number(i.textContent)+1)})),s.addEventListener("click",(function(){D.src=t,D.alt=e,P.textContent=e,n(z)})),c}(e,t,o,r,a))}A.addEventListener("click",(function(){n(E)}));var j,B=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)},J=p.elements.name,H=p.elements.bio;L(!0),fetch("https://nomoreparties.co/v1/plus-cohort-10/users/me",{headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36"}}).then(r).then((function(e){v.textContent=e.name,y.textContent=e.about,J.value=e.name,H.value=e.about,S.style.backgroundImage="url(".concat(e.avatar,")"),v.dataset.myId=e._id})).catch((function(e){k(e)})).finally((function(){L(!1)})),j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,r,a){var c=Array.from(e.querySelectorAll(t)),i=e.querySelector(n);B(c,i),c.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),a.textContent=n,a.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,a),B(c,i,o)}))}))}(e,j.inputSelector,j.submitButtonSelector,j.inactiveButtonClass,j.inputErrorClass,j.errorClass)})),p.addEventListener("submit",(function(e){e.preventDefault(),a(!0,m);var t,n=e.currentTarget.elements,c=n.name,i=n.bio;(t={name:c.value,about:i.value},fetch("https://nomoreparties.co/v1/plus-cohort-10/users/me",{method:"PATCH",headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36","Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})})).then(r).then((function(e){v.textContent=e.name,y.textContent=e.about})).catch((function(e){k(e)})).finally((function(){o(l),a(!1,m)}))})),f.addEventListener("submit",(function(e){var t;e.preventDefault(),a(!0,_),(t={avatar:e.currentTarget.elements.avatar.value},fetch("https://nomoreparties.co/v1/plus-cohort-10/users/me/avatar",{method:"PATCH",headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36","Content-Type":"application/json"},body:JSON.stringify({avatar:t.avatar})})).then(r).then((function(e){S.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){k(e)})).finally((function(){o(d),a(!1,_),f.reset(),_.classList.add("popup__button_disabled"),_.disabled=!0}))})),x.addEventListener("submit",(function(e){e.preventDefault(),L(!0);var t,n=e.currentTarget.elements,a=n.namePlace,c=n.link;(t={name:a.value,link:c.value},fetch("https://nomoreparties.co/v1/plus-cohort-10/cards",{method:"POST",headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36","Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})})).then(r).then((function(e){O(e.name,e.link,e.likes,e.owner._id,e._id)})).catch((function(e){k(e)})).finally((function(){o(E),L(!1),x.reset(),T.classList.add("popup__button_disabled"),T.disabled=!0}))})),fetch("https://nomoreparties.co/v1/plus-cohort-10/cards",{headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36"}}).then(r).then((function(e){e.forEach((function(e){O(e.name,e.link,e.likes,e.owner._id,e._id)}))})).catch((function(e){k(e)})),g.addEventListener("click",(function(e){var t;e.preventDefault(),(t=N,fetch("https://nomoreparties.co/v1/plus-cohort-10/cards/".concat(t),{method:"DELETE",headers:{authorization:"ae17cf5f-30f7-49c5-80a6-f47193e26f36"}})).then(r).catch((function(e){k(e)})).finally((function(){o(C),document.querySelector('[data-card-id="'.concat(N,'"]')).remove()}))}))})();